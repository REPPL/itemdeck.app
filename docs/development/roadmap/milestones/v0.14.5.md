# v0.14.5 - Shared Mechanics Components

## Overview

Extract duplicated patterns from game mechanics into a shared component library. This refactor addresses technical debt from v0.14.0 where five mechanics each implement similar UI patterns independently.

## Problem Statement

After v0.14.0, the codebase has ~800-1000 lines of duplicated code across mechanics:

| Pattern | Files Affected | Est. Duplication |
|---------|---------------|------------------|
| FloatingTimer | memory, snap-ranking, competing, quiz | ~160 lines |
| GameCompletionModal | memory, snap-ranking, competing, quiz | ~400 lines |
| Action Buttons | all 5 mechanics | ~75 lines |
| ErrorOverlay | snap-ranking, competing, quiz, collection | ~140 lines |
| Modal CSS | all 5 mechanics | ~400 lines |

**Impact:**
- UI changes require updating 5+ files
- Inconsistencies between mechanics (different colours, timings)
- New mechanics require copying ~150 lines of boilerplate
- Bug fixes must be applied in multiple places

## Features

| ID | Feature | Complexity | Status |
|----|---------|------------|--------|
| F-095 | Shared FloatingTimer Component | Small | ðŸ“‹ Planned |
| F-096 | Shared GameCompletionModal Component | Medium | ðŸ“‹ Planned |
| F-097 | Shared ErrorOverlay Component | Small | ðŸ“‹ Planned |
| F-098 | useMechanicActions Hook | Small | ðŸ“‹ Planned |
| F-099 | Shared Mechanics CSS Module | Medium | ðŸ“‹ Planned |
| F-100 | Refactor Existing Mechanics | Large | ðŸ“‹ Planned |

## Work Packages

| Package | Description | Dependencies |
|---------|-------------|--------------|
| [WP-A](../../../prompts/implementation/v0.14.5/v0.14.5-shared-components.md) | Shared Components Library + Refactor | None |

## Dependencies

- **v0.14.0**: Advanced Mechanics (prerequisite - must be complete)

## Architecture

### New Directory Structure

```
src/mechanics/
â”œâ”€â”€ shared/                          # NEW
â”‚   â”œâ”€â”€ index.ts                     # Barrel exports
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ FloatingTimer.tsx
â”‚   â”‚   â”œâ”€â”€ GameCompletionModal.tsx
â”‚   â”‚   â”œâ”€â”€ ErrorOverlay.tsx
â”‚   â”‚   â”œâ”€â”€ ActionButtonGroup.tsx
â”‚   â”‚   â””â”€â”€ ProgressBar.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useGameTimer.ts
â”‚   â”‚   â””â”€â”€ useMechanicActions.ts
â”‚   â””â”€â”€ shared.module.css
â”œâ”€â”€ memory/                          # Refactored to use shared
â”œâ”€â”€ snap-ranking/                    # Refactored to use shared
â”œâ”€â”€ competing/                       # Refactored to use shared
â”œâ”€â”€ quiz/                            # Refactored to use shared
â”œâ”€â”€ collection/                      # Refactored to use shared
â”œâ”€â”€ types.ts
â”œâ”€â”€ registry.ts
â”œâ”€â”€ context.tsx
â””â”€â”€ index.ts
```

### Component Interfaces

**FloatingTimer:**
```typescript
interface FloatingTimerProps {
  timeMs: number;
  progressLabel?: string;
  visible: boolean;
}
```

**GameCompletionModal:**
```typescript
interface GameCompletionModalProps {
  isOpen: boolean;
  title: string;
  stats: Array<{ label: string; value: string | number }>;
  primaryAction: { label: string; onClick: () => void };
  secondaryAction?: { label: string; onClick: () => void };
  onExit: () => void;
  children?: ReactNode;
}
```

**ErrorOverlay:**
```typescript
interface ErrorOverlayProps {
  title: string;
  message: string;
  hint?: string;
  onExit: () => void;
  visible: boolean;
}
```

## Success Criteria

- [ ] All shared components extracted to `src/mechanics/shared/`
- [ ] Memory mechanic refactored (components.tsx < 100 lines)
- [ ] Snap Ranking mechanic refactored (components.tsx < 150 lines)
- [ ] Competing mechanic refactored
- [ ] Quiz mechanic refactored
- [ ] Collection mechanic refactored
- [ ] No duplicate FloatingTimer implementations
- [ ] No duplicate completion modal implementations
- [ ] Consistent styling across all mechanics
- [ ] All tests passing
- [ ] Bundle size reduced (CSS deduplication)

## Release Preparation

- [ ] All work packages complete
- [ ] No code duplication in mechanics components
- [ ] Tests passing
- [ ] `/sync-docs` passing
- [ ] `/verify-docs` passing
- [ ] `/pii-scan` passing
- [ ] Documentation updated
- [ ] Devlog created
- [ ] Retrospective written

---

## Related Documentation

- [Roadmap Overview](../README.md)
- [v0.14.0: Advanced Mechanics](./v0.14.0.md)
- [Implementation Prompt](../../../prompts/implementation/v0.14.5/v0.14.5-shared-components.md)

---

**Status**: Planned
