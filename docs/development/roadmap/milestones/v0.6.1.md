# v0.6.1 - UI Configuration & Settings Enhancement

## Theme

Dynamic card rendering driven by collection.json display configuration, enhanced settings panel organisation, and deck sampling.

## Features

| ID | Feature | Complexity | Status |
|----|---------|------------|--------|
| F-042 | Collection Display Driver | Large | ✅ Complete |
| F-043 | Settings Panel Sub-tabs | Medium | ✅ Complete |
| F-044 | Random Card Sampling | Small | ✅ Complete |
| - | Settings Audit & Verification | Medium | ✅ Complete |
| R-003 | External Scores Research | Research | ✅ Complete |

## Overview

This milestone focuses on three main objectives:

### 1. Collection Display Driver (F-042)

Make card rendering fully configurable via `collection.json`'s `display.card` section. This allows:

- **Front configuration**: Title, subtitle, badge, secondary badge, footer, image source
- **Back configuration**: Logo, title, text, and additional fields
- **Field path expressions**: Dynamic access to entity fields (e.g., `platform.title`)
- **Fallback handling**: Graceful degradation when fields are missing

Currently the UI hardcodes field mappings. This feature makes the UI schema-driven.

### 2. Settings Panel Sub-tabs (F-043)

The "Cards" settings tab has grown too large. Split into logical sub-tabs:

- **General**: Card size, gap, border radius, shuffle toggle
- **Front**: Title display, badges, metadata visibility
- **Back**: Logo display, verdict/text settings

Improves settings discoverability and reduces cognitive load.

### 3. Random Card Sampling (F-044)

Add a setting to display only X random cards from the full deck:

- **Use case**: Large collections (100+ items) where users want variety
- **Setting**: "Max visible cards" dropdown from 1 to collection size (plus "All")
- **Behaviour**: Random selection on each shuffle; respects shuffle toggle

### 4. Settings Audit & Verification

Ensure all existing and new settings:

- **Actually work**: Every toggle, slider, and dropdown has visible effect
- **Are accessible**: All settings reachable via Settings panel
- **Persist correctly**: localStorage saves and restores all values
- **Have sensible defaults**: Work well out-of-the-box

### 5. External Scores Research (R-003)

Research integration with external rating sources:

- **Metacritic**: Terms of service, API availability, web scraping legality
- **MobyGames**: API access, data licensing
- **RAWG**: Free API tier, rate limits
- **OpenCritic**: API availability
- **Manual enrichment**: CSV import, manual entry

Output: State-of-the-art research document with recommendations.

## Implementation Approach

### Phase 1: Field Path Parser (Foundation)

1. Create `parseFieldPath(path: string, entity: ResolvedEntity)` utility
2. Handle dot notation: `platform.title`
3. Handle array expressions: `images[type=cover][0]`
4. Handle fallbacks: `?? images[0]`
5. Add comprehensive tests

### Phase 2: Display Configuration Types

1. Define TypeScript types for display configuration
2. Extend `collection.json` schema for validation
3. Create `DisplayConfig` interface matching schema

### Phase 3: Card Component Refactor

1. Create `ConfigurableCard` component or modify existing `Card`
2. Accept display configuration as prop
3. Use field path parser to extract values dynamically
4. Handle missing fields gracefully with fallbacks

### Phase 4: Settings Panel Restructure

1. Create `CardSettingsTabs` component with sub-tabs
2. Move existing settings into appropriate tabs
3. Add "Max visible cards" setting
4. Implement random sampling logic in `useCollection` or grid component

### Phase 5: External Scores Research

1. Research legal requirements for each source
2. Document API availability and rate limits
3. Evaluate manual vs automated enrichment
4. Write state-of-the-art document

## Success Criteria

### F-042 (Collection Display Driver)
- [x] Cards render title/subtitle from `display.card.front.title`/`subtitle` paths
- [x] Badges render from `display.card.front.badge`/`secondaryBadge` paths
- [x] Card back renders from `display.card.back` configuration
- [x] Field path expressions work with dot notation and array filters
- [x] Missing fields show placeholder or hide gracefully
- [x] Existing v1 collection.json format works without changes

### F-043 (Settings Panel Sub-tabs)
- [x] "Cards" tab splits into Layout/Front/Back sub-tabs
- [x] All existing settings retain functionality
- [x] Tab state persists during session
- [x] Keyboard navigation works within sub-tabs

### F-044 (Random Card Sampling)
- [x] "Random Selection" toggle in Config > Display sub-tab
- [x] Slider shows [N/N] format for count selection
- [x] Random selection applied on load
- [x] Disabled toggle restores full deck
- [x] Setting persists in localStorage
- [x] Value clamps when switching to smaller collections

### Settings Audit
- [x] Every setting in the panel has a visible effect on the UI
- [x] All display-related settings accessible via Settings panel
- [x] All settings persist correctly in localStorage
- [x] Settings load correctly on page refresh
- [x] No orphaned settings (settings that exist but do nothing)
- [x] No hidden settings (functionality that should be configurable but isn't)

### R-003 (External Scores Research)
- [x] Research document created in `docs/development/research/`
- [x] Legal requirements documented for each source
- [x] API availability and rate limits documented
- [x] Recommendation provided for itemdeck integration

## Dependencies

- **Requires**: v0.6.0 Schema Loader (for field path parsing foundation)
- **Blocks**: Future data enrichment features

## Technical Considerations

### Field Path Parser

The existing image selector in `loaders/imageSelector.ts` has array filter logic. This should be generalised to support any field path.

```typescript
// Examples of paths to support:
"title"                          // Simple field
"platform.title"                 // Nested via relationship
"images[type=cover][0].url"      // Array filter + index + nested
"verdict ?? summary"             // Fallback chain
"playedSince ?? year"            // Fallback chain
```

### Settings State

Current settings use Zustand with localStorage. Sub-tabs don't require schema changes—just UI reorganisation.

### Random Sampling

Implement in `useCollection` hook or at grid level. Should work with existing shuffle logic.

## Draft Release Notes

### Added
- Dynamic card rendering from `collection.display.card` configuration
- Field path expressions for flexible data binding
- Settings panel sub-tabs (General, Front, Back)
- "Max visible cards" setting for deck sampling

### Changed
- Cards now respect collection-level display configuration
- Settings panel reorganised for better discoverability

### Documentation
- External scores research document

---

## Related Documentation

- [Roadmap Overview](../README.md)
- [Features Index](../features/README.md)
- [v0.6.0 Schema Loader](./v0.6.0.md)
- [v1 Schema Reference](../../../reference/schemas/v1/README.md)
- [External Scores Research](../../research/R-003-external-scores.md) (to be created)

---

**Status**: Complete
