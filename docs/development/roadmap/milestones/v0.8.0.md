# v0.8.0 - Visual Overhaul, Configuration & Caching

## Theme

Major visual polish, configuration externalisation, external theme system, and IndexedDB image caching.

## Features

| ID | Feature | Complexity | Status |
|----|---------|------------|--------|
| - | Visual Polish Fixes | Small | ✅ Complete |
| - | UI Labels Configuration | Medium | ✅ Complete |
| - | External Theme System | Large | ✅ Complete |
| - | Full Config Externalisation | Medium | ✅ Complete |
| - | IndexedDB Image Caching | Large | ✅ Complete |
| - | Loading Screen with Progress | Medium | ✅ Complete |
| - | Storage Management UI | Medium | ✅ Complete |

## Overview

This milestone implements five major capability areas:

1. **Visual Polish** - Drag handle animation fix + adaptive text contrast for light backgrounds + extra colour settings
2. **Configuration Externalisation** - UI labels and defaults configurable per collection
3. **External Theme System** - Load themes from local folder or curated remote sources
4. **Full IndexedDB Caching** - Image blob caching with LRU eviction
5. **Storage Management** - Clear cache functionality in settings

## Implementation Summary

### Phase 0: Visual Polish Fixes

- Fixed drag handle remaining visible during card flip animation
- Implemented adaptive text contrast for light card backgrounds using WCAG 2.1 luminance calculation
- Added extra colour settings: card back extra colour 1/2/3, card back text colour override, rank badge text colour

### Phase 1: UI Labels Configuration

- Created `CollectionUIContext` for customisable UI labels
- Added Zod schema `UILabelsSchema` in collection schema v2
- Components now use `useUILabels()` hook for all button text
- Labels merge with defaults (partial override supported)

### Phase 2: External Theme System

- Created `theme.schema.ts` with comprehensive Zod validation
- Created `themeLoader.ts` for loading and validating theme JSON files
- Created `useThemeLoader.ts` hook with TanStack Query integration
- Created `themeRegistry.ts` for curated theme sources
- Added theme selector UI in settings panel
- Example themes in `public/themes/`

### Phase 3: Full Config Externalisation

- Extended collection schema with `config` section
- Added `applyCollectionDefaults` action to settings store
- New users get collection defaults applied automatically
- Existing users keep their settings (migration to version 13)

### Phase 4: IndexedDB Image Caching

- Created `src/db/index.ts` - IndexedDB database module using `idb` library
- Created `src/services/imageCache.ts` - Image caching service with LRU eviction
- Created `src/hooks/useImageCache.ts` - React hooks for cache operations
- Implements 50MB cache limit with automatic eviction of least recently used images

### Phase 5: Loading Screen with Progress

- Created `LoadingScreen` component with collection and image loading phases
- Shows progress bar during initial load
- Themed to match visual theme setting
- Minimum display time prevents flash

### Phase 6: Storage Management UI

- Created `StorageSettingsTabs` component in settings panel
- Shows cache statistics (image count, storage used, usage percentage)
- Clear cache button with confirmation
- Information about automatic LRU eviction

## Dependencies

- **Requires**: v0.7.2 (Visual Polish)
- **Blocks**: v0.9.0 (Remote Source Intelligence)

## Release Notes

### Added

- UI labels configurable per collection via `uiLabels` in collection.json
- External theme system with local and remote theme loading
- Collection-level config defaults (applied for new users only)
- IndexedDB-based image caching with 50MB limit and LRU eviction
- Loading screen with progress indication during image preloading
- Storage management UI in settings panel
- Extra colour settings: card back extra colours, text colour overrides

### Changed

- Settings store migrated to version 13 with collection defaults tracking
- Card back now uses adaptive text contrast for light backgrounds
- Drag handle hidden during card flip animation

### Improved

- Offline support with cached images
- Initial load experience with progress indication
- Theme customisation with external JSON themes
- Configuration flexibility with collection-level defaults

## Test Coverage

- 23 new tests added
- 346 total tests passing
- Image cache service: 12 tests
- Settings store config: 11 tests

---

## Related Documentation

- [v0.7.2 Milestone](./v0.7.2.md)
- [v0.9.0 Milestone](./v0.9.0.md)
- [Implementation Prompt](../../prompts/implementation/v0.8.0/README.md)
- [Roadmap Overview](../README.md)

---

**Status**: Complete
