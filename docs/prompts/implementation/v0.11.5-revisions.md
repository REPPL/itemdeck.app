# v0.11.5 Implementation Revisions

This document tracks additional changes made during v0.11.5 implementation that were not in the original implementation prompt.

---

## Session Revisions (2024-12-28)

### 1. Info Button Position Adjustment

**Request:** Move info icon in 'hot corner' up and to the right so it doesn't touch the lower border.

**Changes:**
- `src/components/Card/Card.module.css`:
  - Changed `.infoButton svg` top from `18%` to `12%`
  - Changed `.infoButton svg` right from `14%` to `18%`

---

### 2. Settings Search Box Overflow Fix

**Request:** Settings search box sticks out of settings overlay.

**Changes:**
- `src/components/SettingsPanel/SettingsPanel.module.css`:
  - Added `overflow: visible` to `.header`
  - Added `position: relative` to `.header`
  - Added `gap: var(--spacing-md)` to `.header`

---

### 3. Reset Confirmation Dialog

**Request:** Reset button has no confirmation dialogue.

**Changes:**
- `src/components/SettingsPanel/SettingsPanel.tsx`:
  - Added `showResetConfirm` state
  - Added `handleResetClick`, `handleResetConfirm`, `handleResetCancel` callbacks
  - Added `ConfirmDialog` component for Reset confirmation

- `src/components/SettingsPanel/DataTab/ThemesTab.tsx`:
  - Replaced `window.confirm` with `ConfirmDialog` for Reset Theme button

---

### 4. Dynamic Group By Options

**Request:** View mode has collection-specific options hard coded.

**Changes:**
- Created `src/hooks/useAvailableGroupFields.ts`:
  - New hook that examines collection data to determine available grouping options
  - Only shows options (Platform, Year, Decade, Genre) if corresponding fields exist in data

- `src/components/ViewPopover/ViewPopover.tsx`:
  - Updated to use `useAvailableGroupFields` hook instead of static options

---

### 5. Random Selection Count Limit

**Request:** Random count option should be limited to the maximum number of cards.

**Changes:**
- `src/components/SettingsPanel/QuickSettings.tsx`:
  - Added clamping: `setRandomSelectionCount(Math.min(Math.max(1, value), totalCardCount))`

---

### 6. Placeholder Images Toggle

**Request:** Retro Adverts use dummy images. Add setting to toggle placeholder images, show colour and title instead when disabled.

**Changes:**
- `src/stores/settingsStore.ts`:
  - Added `usePlaceholderImages: boolean` state (default: true)
  - Added `setUsePlaceholderImages` action
  - Added migration to v26

- `src/components/SettingsPanel/SystemSettings.tsx`:
  - Added "Use Placeholder Images" toggle under Cards section in UI Visibility tab

- `src/components/ImageWithFallback/ImageWithFallback.tsx`:
  - Added `isPlaceholderUrl?: boolean` prop
  - When true, skips loading image and shows coloured background with title

- `src/components/Card/CardFront.tsx`:
  - Added detection of picsum.photos URLs
  - Passes `isPlaceholderUrl` to ImageWithFallback based on `usePlaceholderImages` setting

---

### 7. View Button in UI Visibility

**Request:** Settings > System > UI Visibility should include all navigation buttons including View.

**Changes:**
- `src/stores/settingsStore.ts`:
  - Added `showViewButton: boolean` state (default: true)
  - Added `setShowViewButton` action
  - Added migration to v26

- `src/components/SettingsPanel/SystemSettings.tsx`:
  - Reorganised UI Visibility tab with section headers: "Navigation Hub", "Other UI Elements", "Cards"
  - Added "Show View Button" toggle

---

### 8. Hide NavigationHub When Overlays Open

**Request:** Hide NavigationHub when View/Search overlays are open.

**Changes:**
- `src/components/NavigationHub/NavigationHub.tsx`:
  - Added `hidden?: boolean` prop to interface
  - Added early return `if (hidden) return null;`

- `src/App.tsx`:
  - Added `hidden={!searchBarMinimised || viewPopoverOpen}` prop to NavigationHub

---

### 9. Dynamic Background Options

**Request:** Filter Collection backgrounds based on available data.

**Changes:**
- Created `src/hooks/useAvailableBackgrounds.ts`:
  - New hook that examines collection data to determine available logo-based backgrounds
  - Built-in patterns and app logo always available
  - Collection logos (Platform Logo, Card Logo) only shown if corresponding fields exist

- `src/components/SettingsPanel/CardSettingsTabs.tsx`:
  - Updated to use `useAvailableBackgrounds` hook
  - Collection optgroup only rendered if collection backgrounds are available

---

## Deferred Features

### Settings Draft State Pattern

**Request:** Changes to settings should only be activated when user clicks 'Accept', not immediately.

**Status:** Deferred to future milestone.

**Rationale:** This requires a major architectural change:
1. Every setting would need a "draft" and "committed" state
2. All settings components would need to track unsaved changes
3. Validation would need to run on Accept
4. Complex state management for nested settings (theme customisations)

This is estimated as a multi-session effort and is better suited for a dedicated milestone.

---

## Files Modified Summary

| File | Changes |
|------|---------|
| `src/components/Card/Card.module.css` | Info button position |
| `src/components/SettingsPanel/SettingsPanel.module.css` | Header overflow fix |
| `src/components/SettingsPanel/SettingsPanel.tsx` | Reset confirmation dialog |
| `src/components/SettingsPanel/DataTab/ThemesTab.tsx` | Reset theme confirmation |
| `src/components/SettingsPanel/QuickSettings.tsx` | Random count clamping |
| `src/components/SettingsPanel/SystemSettings.tsx` | View toggle, placeholder toggle, sections |
| `src/components/SettingsPanel/CardSettingsTabs.tsx` | Dynamic backgrounds |
| `src/components/NavigationHub/NavigationHub.tsx` | Hidden prop |
| `src/components/Card/CardFront.tsx` | Placeholder detection |
| `src/components/ImageWithFallback/ImageWithFallback.tsx` | isPlaceholderUrl prop |
| `src/components/ViewPopover/ViewPopover.tsx` | Dynamic group options |
| `src/stores/settingsStore.ts` | New settings, migration v26 |
| `src/App.tsx` | NavigationHub hidden prop |

## Files Created

| File | Purpose |
|------|---------|
| `src/hooks/useAvailableGroupFields.ts` | Dynamic Group By options based on collection data |
| `src/hooks/useAvailableBackgrounds.ts` | Dynamic background options based on collection data |

---

## Testing

- TypeScript check: ✅ Pass
- ESLint: ✅ Pass (no new errors in modified files)
- Build: ✅ Pass
- Unit tests: ✅ 450 tests pass
