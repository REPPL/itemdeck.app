# Work Package E: Developer Documentation & ADRs

## Overview

Create comprehensive developer documentation for plugin creation, along with Architecture Decision Records documenting the plugin system design.

**Version:** v0.13.0
**Dependencies:** WP-A (Plugin Core) and WP-B (Migration) must be complete
**Estimated Scope:** ~15 documentation files

---

## Context

After WP-A and WP-B complete, the plugin system is fully functional with:
- Plugin manifest schemas
- Plugin loader and cache
- Security sandbox
- Built-in plugins (themes, mechanics, sources)
- Plugin UI components

This work package documents the system for plugin developers.

---

## Objectives

1. Create plugin development getting started guide
2. Create manifest reference documentation
3. Create API reference documentation
4. Create security guidelines
5. Create publishing guide
6. Create plugin templates
7. Create example plugins documentation
8. Document architectural decisions (ADRs)
9. Create state-of-the-art research document

---

## Plugin Developer Documentation

**Location:** `docs/development/plugins/`

### 1. getting-started.md

**Purpose:** Quick start guide for plugin developers

**Content:**
```markdown
# Plugin Development: Getting Started

Create your first itemdeck plugin in 15 minutes.

## Prerequisites
- Node.js 20+
- Basic TypeScript knowledge
- Familiarity with itemdeck

## What You'll Build
A simple theme plugin that changes itemdeck's colour scheme.

## Step 1: Create Project Structure

```bash
mkdir my-theme-plugin
cd my-theme-plugin
```

Create the following files:

```
my-theme-plugin/
├── manifest.json
├── theme.css
└── README.md
```

## Step 2: Write the Manifest

Create `manifest.json`:

```json
{
  "$schema": "https://itemdeck.app/schemas/plugin/v1.json",
  "id": "com.example.my-theme",
  "name": "My Custom Theme",
  "version": "1.0.0",
  "description": "A custom theme for itemdeck",
  "author": {
    "name": "Your Name"
  },
  "licence": "MIT",
  "itemdeck": {
    "minVersion": "0.13.0",
    "type": "theme",
    "tier": "community"
  },
  "capabilities": [],
  "entry": {
    "styles": "./theme.css"
  },
  "contributes": {
    "themes": [{
      "id": "my-theme",
      "name": "My Theme",
      "description": "A beautiful custom theme",
      "type": "dark",
      "tokens": {
        "colours": {
          "primary": "#6366f1",
          "secondary": "#8b5cf6",
          "background": "#1e1e2e",
          "surface": "#2a2a3e",
          "text": "#cdd6f4",
          "textMuted": "#7f849c"
        }
      }
    }]
  }
}
```

## Step 3: Add Custom CSS

Create `theme.css`:

```css
/* Custom styles for my theme */
[data-theme="my-theme"] .card {
  border: 2px solid var(--colour-primary);
}

[data-theme="my-theme"] .card:hover {
  box-shadow: 0 0 20px var(--colour-primary);
}
```

## Step 4: Test Locally

1. Host your plugin folder (e.g., using a local server or GitHub Pages)
2. In itemdeck, go to Settings > Plugins
3. Click "Install from URL"
4. Enter the URL to your manifest.json
5. Install and enable the plugin

## Step 5: Package for Distribution

Create a ZIP bundle:

```bash
zip -r my-theme-plugin.zip manifest.json theme.css README.md
```

## Next Steps

- [Manifest Reference](./manifest-reference.md) - Full manifest specification
- [API Reference](./api-reference.md) - Available APIs for plugins
- [Security Guidelines](./security-guidelines.md) - Security best practices
- [Publishing](./publishing.md) - Submit to the registry

---

## Related Documentation
- [Plugin Architecture](../../explanation/plugin-architecture.md)
- [Theme Contribution Schema](./manifest-reference.md#themes)
```

---

### 2. manifest-reference.md

**Purpose:** Complete manifest specification

**Content:**
```markdown
# Plugin Manifest Reference

Complete specification for itemdeck plugin manifests.

## Schema

Plugin manifests must be valid JSON files named `manifest.json` at the root of the plugin package.

**JSON Schema:** `https://itemdeck.app/schemas/plugin/v1.json`

## Root Properties

### Required Properties

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique plugin identifier (reverse domain notation) |
| `name` | string | Display name (1-50 characters) |
| `version` | string | Semantic version (e.g., "1.0.0") |
| `description` | string | Short description (max 500 characters) |
| `author` | object | Author information |
| `itemdeck` | object | itemdeck compatibility information |

### Optional Properties

| Property | Type | Description |
|----------|------|-------------|
| `$schema` | string | JSON schema URL |
| `licence` | string | SPDX licence identifier |
| `homepage` | string | Plugin homepage URL |
| `repository` | string | Source repository URL |
| `keywords` | string[] | Search keywords (max 10) |
| `capabilities` | string[] | Required capabilities |
| `dependencies` | object | Plugin dependencies |
| `entry` | object | Entry points |
| `contributes` | object | Plugin contributions |

## Author Object

```json
{
  "author": {
    "name": "Developer Name",      // Required
    "url": "https://example.org",  // Optional
    "email": "dev@example.org"     // Optional
  }
}
```

## itemdeck Object

```json
{
  "itemdeck": {
    "minVersion": "0.13.0",           // Required: Minimum itemdeck version
    "maxVersion": "1.x",              // Optional: Maximum itemdeck version
    "type": "theme",                  // Required: Plugin type
    "tier": "community"               // Required: Distribution tier
  }
}
```

### Plugin Types

| Type | Description |
|------|-------------|
| `theme` | Visual styling plugin |
| `mechanic` | Game mechanic plugin |
| `source` | Data source plugin |
| `settings` | Settings contribution plugin |
| `bundle` | Multiple contribution types |

### Distribution Tiers

| Tier | Description |
|------|-------------|
| `builtin` | Bundled with itemdeck |
| `official` | Published in official registry |
| `community` | User-provided URL |

## Capabilities

Capabilities define what permissions your plugin needs.

### Storage Capabilities

| Capability | Description | Risk |
|------------|-------------|------|
| `storage:local` | Store data in browser | Low |
| `storage:sync` | Sync data across devices | Low |
| `storage:unlimited` | No storage limits | Medium |

### UI Capabilities

| Capability | Description | Risk |
|------------|-------------|------|
| `ui:notifications` | Show notifications | Low |
| `ui:modal` | Display modals | Low |
| `ui:overlay` | Full-screen overlays | Medium |

### Collection Capabilities

| Capability | Description | Risk |
|------------|-------------|------|
| `collection:read` | Read card data | Low |
| `collection:write` | Modify card data | High |
| `collection:delete` | Delete cards | High |

### Network Capabilities

| Capability | Description | Risk |
|------------|-------------|------|
| `fetch:sameorigin` | Same-origin requests | Low |
| `fetch:external` | External requests | High |

## Entry Points

```json
{
  "entry": {
    "main": "./dist/index.js",     // Main JavaScript entry
    "styles": "./dist/styles.css", // CSS styles
    "worker": "./dist/worker.js"   // Web Worker entry
  }
}
```

## Contributions

### Theme Contributions

```json
{
  "contributes": {
    "themes": [{
      "id": "my-theme",
      "name": "My Theme",
      "description": "Description",
      "type": "dark",
      "tokens": {
        "colours": {
          "primary": "#...",
          "secondary": "#...",
          "background": "#...",
          "surface": "#...",
          "text": "#...",
          "textMuted": "#...",
          "accent": "#...",
          "error": "#...",
          "success": "#...",
          "warning": "#..."
        },
        "typography": {
          "fontFamily": "...",
          "fontFamilyMono": "..."
        },
        "borders": {
          "radius": "...",
          "width": "..."
        },
        "shadows": {
          "small": "...",
          "medium": "...",
          "large": "..."
        }
      },
      "css": "./theme.css"
    }]
  }
}
```

### Mechanic Contributions

```json
{
  "contributes": {
    "mechanics": [{
      "id": "my-game",
      "name": "My Game",
      "description": "A custom game",
      "icon": "./assets/icon.svg",
      "category": "puzzle",
      "minCards": 4,
      "maxCards": 52,
      "playerCount": { "min": 1, "max": 4 },
      "difficulty": "easy",
      "entry": "./mechanic.js",
      "ui": {
        "component": "./components/GameUI.js",
        "overlay": true
      }
    }]
  }
}
```

### Source Contributions

```json
{
  "contributes": {
    "sources": [{
      "id": "my-source",
      "name": "My Source",
      "description": "Load from my service",
      "icon": "./assets/icon.svg",
      "config": {
        "schema": {
          "type": "object",
          "properties": {
            "apiKey": { "type": "string" }
          }
        }
      },
      "entry": "./source.js"
    }]
  }
}
```

### Settings Contributions

```json
{
  "contributes": {
    "settings": [{
      "id": "myPlugin.option",
      "type": "boolean",
      "label": "Enable Feature",
      "description": "Toggle this feature on or off",
      "default": true,
      "scope": "user",
      "category": "My Plugin"
    }]
  }
}
```

---

## Related Documentation
- [API Reference](./api-reference.md)
- [Security Guidelines](./security-guidelines.md)
```

---

### 3. api-reference.md

**Purpose:** Document APIs available to plugins

**Content:**
```markdown
# Plugin API Reference

APIs available to itemdeck plugins.

## Overview

Plugins interact with itemdeck through a sandboxed API. The API surface depends on granted capabilities.

## Core API

All plugins have access to the core API.

### itemdeck.plugin

```typescript
interface PluginAPI {
  // Plugin information
  readonly id: string;
  readonly version: string;

  // Lifecycle
  onActivate(callback: () => void): void;
  onDeactivate(callback: () => void): void;
}
```

### itemdeck.log

```typescript
interface LogAPI {
  info(message: string, ...args: any[]): void;
  warn(message: string, ...args: any[]): void;
  error(message: string, ...args: any[]): void;
  debug(message: string, ...args: any[]): void;
}
```

## Storage API

**Requires:** `storage:local` or `storage:sync`

```typescript
interface StorageAPI {
  // Get a value
  get<T>(key: string): Promise<T | undefined>;

  // Set a value
  set<T>(key: string, value: T): Promise<void>;

  // Delete a value
  delete(key: string): Promise<void>;

  // Get all keys
  keys(): Promise<string[]>;

  // Clear all plugin storage
  clear(): Promise<void>;
}

// Usage
const value = await itemdeck.storage.get('myKey');
await itemdeck.storage.set('myKey', { foo: 'bar' });
```

## UI API

**Requires:** `ui:notifications`, `ui:modal`, or `ui:overlay`

```typescript
interface UIAPI {
  // Show notification
  notify(message: string, options?: NotifyOptions): void;

  // Show modal (returns user response)
  showModal(options: ModalOptions): Promise<ModalResult>;

  // Register overlay component
  registerOverlay(id: string, component: ComponentType): void;

  // Show/hide overlay
  showOverlay(id: string): void;
  hideOverlay(id: string): void;
}

interface NotifyOptions {
  type?: 'info' | 'success' | 'warning' | 'error';
  duration?: number; // milliseconds
}
```

## Collection API

**Requires:** `collection:read` (or `collection:write` for mutations)

```typescript
interface CollectionAPI {
  // Get all cards in current collection
  getCards(): Promise<CardData[]>;

  // Get selected cards
  getSelectedCards(): Promise<CardData[]>;

  // Get collection metadata
  getMetadata(): Promise<CollectionMeta>;

  // Modify a card (requires collection:write)
  updateCard(cardId: string, updates: Partial<CardData>): Promise<void>;
}

interface CardData {
  id: string;
  title: string;
  description?: string;
  imageUrl?: string;
  metadata?: Record<string, unknown>;
}
```

## Events API

Subscribe to itemdeck events.

```typescript
interface EventsAPI {
  // Subscribe to event
  on(event: string, handler: EventHandler): void;

  // Unsubscribe from event
  off(event: string, handler: EventHandler): void;

  // Emit custom event (plugin-namespaced)
  emit(event: string, data: unknown): void;
}

// Available events
type ItemdeckEvent =
  | 'collection:loaded'
  | 'collection:changed'
  | 'card:selected'
  | 'card:deselected'
  | 'theme:changed'
  | 'mechanic:started'
  | 'mechanic:ended';
```

## Mechanic API

For mechanic plugins only.

```typescript
interface MechanicAPI {
  // Register mechanic implementation
  register(manifest: MechanicManifest, implementation: MechanicImplementation): void;
}

interface MechanicImplementation {
  // Called when game starts
  start(cards: CardData[], config: unknown): Promise<MechanicState>;

  // Handle user action
  handleAction(action: MechanicAction): Promise<MechanicState>;

  // Get current state
  getState(): MechanicState;

  // Cleanup when game ends
  dispose(): Promise<void>;
}

interface MechanicState {
  phase: 'setup' | 'playing' | 'paused' | 'ended';
  data: unknown;
  ui?: {
    overlay?: boolean;
    message?: string;
  };
}
```

## Theme API

For theme plugins only.

```typescript
interface ThemeAPI {
  // Register theme
  register(manifest: ThemeManifest): void;

  // Get current theme
  getCurrent(): string | null;

  // Apply theme programmatically
  apply(themeId: string): void;
}
```

---

## Related Documentation
- [Manifest Reference](./manifest-reference.md)
- [Security Guidelines](./security-guidelines.md)
```

---

### 4. security-guidelines.md

**Purpose:** Security best practices for plugin developers

**Content:**
```markdown
# Plugin Security Guidelines

Best practices for creating secure itemdeck plugins.

## Overview

itemdeck's plugin system prioritises user security. Community plugins run in a sandboxed environment with limited capabilities. Following these guidelines helps your plugin get approved and keeps users safe.

## The Sandbox

Community plugins execute in a Web Worker sandbox:
- No direct DOM access
- No access to `window`, `document`, `localStorage`
- Network requests go through capability-gated API
- Code execution is isolated

## Capability Principles

### Request Minimum Capabilities

Only request capabilities your plugin actually needs:

```json
// Good - minimal capabilities
"capabilities": ["storage:local", "ui:notifications"]

// Bad - over-requesting
"capabilities": [
  "storage:unlimited",
  "collection:write",
  "fetch:external"
]
```

### Justify High-Risk Capabilities

If you need high-risk capabilities, explain why in your README:

```markdown
## Permissions

This plugin requires `fetch:external` because it loads
card data from the XYZ API service.
```

## Data Handling

### Don't Store Sensitive Data

Never store:
- Passwords or credentials
- Personal information
- API keys in client-side storage

### Validate All Input

Always validate data from external sources:

```typescript
// Good
const data = await fetchExternalData();
if (!isValidFormat(data)) {
  throw new Error('Invalid data format');
}

// Bad
const data = await fetchExternalData();
processData(data); // Trusting external data
```

### Sanitise User Content

If displaying user-provided content:

```typescript
// Good
const safeContent = sanitiseHtml(userContent);

// Bad
element.innerHTML = userContent; // XSS vulnerability
```

## Network Security

### Use HTTPS

Always use HTTPS for external requests:

```typescript
// Good
const response = await itemdeck.fetch('https://api.example.com/data');

// Bad
const response = await itemdeck.fetch('http://api.example.com/data');
```

### Validate Responses

Check response integrity:

```typescript
const response = await itemdeck.fetch(url);

if (!response.ok) {
  throw new Error(`Request failed: ${response.status}`);
}

const data = await response.json();
if (!validateSchema(data)) {
  throw new Error('Invalid response schema');
}
```

## Code Quality

### No eval() or Function()

These are blocked in the sandbox:

```typescript
// Blocked
eval('malicious code');
new Function('return this')();
```

### No Dynamic Script Loading

```typescript
// Blocked
importScripts('https://malicious.com/script.js');
```

### Handle Errors Gracefully

```typescript
try {
  await riskyOperation();
} catch (error) {
  itemdeck.log.error('Operation failed:', error);
  itemdeck.ui.notify('Something went wrong', { type: 'error' });
}
```

## Privacy

### Minimise Data Collection

Only collect data essential for functionality.

### Be Transparent

Document what data your plugin collects and why.

### Respect User Preferences

Honour user settings for analytics, telemetry, etc.

## Testing

### Test in Sandbox Mode

Always test your plugin as a community plugin to ensure it works within sandbox restrictions.

### Test Error Scenarios

Verify graceful handling of:
- Network failures
- Invalid data
- Missing permissions

## Reporting Vulnerabilities

If you discover a security issue in itemdeck or a plugin:

1. Do not publicly disclose the issue
2. Contact the itemdeck team directly
3. Allow time for a fix before disclosure

---

## Related Documentation
- [API Reference](./api-reference.md)
- [Publishing](./publishing.md)
```

---

### 5. publishing.md

**Purpose:** Guide to publishing plugins

**Content:**
```markdown
# Publishing Plugins

Submit your plugin to the itemdeck registry.

## Publication Tiers

### Community (Self-Hosted)
Host your plugin yourself and share the URL.

**Pros:**
- Immediate availability
- Full control

**Cons:**
- Runs in sandbox
- Users see security warnings
- Manual distribution

### Official Registry
Submit for review to be listed in the registry.

**Pros:**
- Discoverability in plugin browser
- Trusted status (no warnings)
- Automatic updates

**Cons:**
- Review process required
- Must meet guidelines

## Preparing for Submission

### Checklist

- [ ] Manifest is valid JSON
- [ ] All required fields present
- [ ] Version follows semver
- [ ] Description is accurate
- [ ] Licence is specified
- [ ] README.md included
- [ ] CHANGELOG.md included
- [ ] No security issues
- [ ] Tested thoroughly

### Required Files

```
my-plugin/
├── manifest.json     # Required
├── README.md         # Required
├── CHANGELOG.md      # Required
├── LICENSE           # Recommended
└── [plugin files]    # Your implementation
```

### README Template

```markdown
# Plugin Name

Brief description.

## Features
- Feature 1
- Feature 2

## Installation
1. Open itemdeck Settings
2. Go to Plugins tab
3. Search for "Plugin Name"
4. Click Install

## Usage
How to use the plugin...

## Permissions
Explain any permissions required.

## Changelog
See CHANGELOG.md

## Licence
MIT (or your licence)
```

## Submission Process

### 1. Create GitHub Repository

Host your plugin source on GitHub.

### 2. Create Release

Tag a release with your version number:

```bash
git tag v1.0.0
git push origin v1.0.0
```

### 3. Submit for Review

Open an issue on the [itemdeck-plugins](https://github.com/itemdeck/plugins) repository:

**Title:** `[Submission] Plugin Name v1.0.0`

**Body:**
```markdown
## Plugin Information
- **Name:** My Plugin
- **Repository:** https://github.com/you/my-plugin
- **Version:** 1.0.0
- **Type:** theme/mechanic/source

## Description
What does your plugin do?

## Checklist
- [ ] Manifest is valid
- [ ] README.md included
- [ ] CHANGELOG.md included
- [ ] Tested on latest itemdeck
- [ ] No security issues
```

### 4. Review Process

The itemdeck team will:
1. Validate manifest
2. Review code for security
3. Test functionality
4. Provide feedback or approve

### 5. Publication

Once approved, your plugin appears in the registry.

## Updating Your Plugin

1. Update version in manifest.json
2. Update CHANGELOG.md
3. Create new GitHub release
4. Open update request issue

## Guidelines

### Naming
- Use descriptive names
- Don't impersonate other plugins
- Avoid trademarked names

### Quality
- Plugin should work as described
- Handle errors gracefully
- Provide useful documentation

### Behaviour
- Don't collect unnecessary data
- Don't interfere with other plugins
- Respect user preferences

---

## Related Documentation
- [Manifest Reference](./manifest-reference.md)
- [Security Guidelines](./security-guidelines.md)
```

---

### 6. Plugin Templates

**Location:** `docs/development/plugins/templates/`

#### theme-template/manifest.json

```json
{
  "$schema": "https://itemdeck.app/schemas/plugin/v1.json",
  "id": "com.example.TEMPLATE-theme",
  "name": "TEMPLATE Theme",
  "version": "1.0.0",
  "description": "A custom theme for itemdeck",
  "author": {
    "name": "Your Name",
    "url": "https://your-website.com"
  },
  "licence": "MIT",
  "itemdeck": {
    "minVersion": "0.13.0",
    "type": "theme",
    "tier": "community"
  },
  "capabilities": [],
  "entry": {
    "styles": "./theme.css"
  },
  "contributes": {
    "themes": [{
      "id": "TEMPLATE",
      "name": "TEMPLATE Theme",
      "description": "Your theme description",
      "type": "dark",
      "tokens": {
        "colours": {
          "primary": "#6366f1",
          "secondary": "#8b5cf6",
          "background": "#1e1e2e",
          "surface": "#2a2a3e",
          "text": "#cdd6f4",
          "textMuted": "#7f849c",
          "accent": "#f5c2e7",
          "error": "#f38ba8",
          "success": "#a6e3a1",
          "warning": "#f9e2af"
        },
        "typography": {
          "fontFamily": "system-ui, sans-serif",
          "fontFamilyMono": "monospace"
        },
        "borders": {
          "radius": "8px",
          "width": "1px"
        },
        "shadows": {
          "small": "0 1px 2px rgba(0,0,0,0.1)",
          "medium": "0 4px 6px rgba(0,0,0,0.1)",
          "large": "0 10px 15px rgba(0,0,0,0.1)"
        }
      }
    }]
  }
}
```

#### mechanic-template/manifest.json

```json
{
  "$schema": "https://itemdeck.app/schemas/plugin/v1.json",
  "id": "com.example.TEMPLATE-mechanic",
  "name": "TEMPLATE Mechanic",
  "version": "1.0.0",
  "description": "A custom game mechanic for itemdeck",
  "author": {
    "name": "Your Name"
  },
  "licence": "MIT",
  "itemdeck": {
    "minVersion": "0.13.0",
    "type": "mechanic",
    "tier": "community"
  },
  "capabilities": ["storage:local", "ui:overlay", "collection:read"],
  "entry": {
    "main": "./mechanic.js"
  },
  "contributes": {
    "mechanics": [{
      "id": "TEMPLATE",
      "name": "TEMPLATE Game",
      "description": "Your game description",
      "category": "puzzle",
      "minCards": 4,
      "maxCards": 52,
      "playerCount": { "min": 1, "max": 1 },
      "difficulty": "easy"
    }]
  }
}
```

---

## Architecture Decision Records

**Location:** `docs/development/decisions/adrs/`

### ADR-020-plugin-architecture.md

```markdown
# ADR-020: Plugin Architecture

## Status
Accepted

## Context
itemdeck needs a modular architecture to support:
- Custom themes beyond the built-in options
- Community-created game mechanics
- Alternative data sources
- Extended settings

We need an extensibility system that balances flexibility with security.

## Decision
Implement a JSON-manifest-based plugin architecture with:

1. **Plugin Types:** Settings, Themes, Mechanics, Sources
2. **Distribution Tiers:** Built-in, Official, Community
3. **Capability System:** Permission-based access control
4. **Sandbox Execution:** Web Workers for community plugins
5. **Registry Pattern:** Static JSON registry initially

## Consequences

### Positive
- Clear extension points for community
- Security through capability-based permissions
- Familiar pattern (similar to VS Code, Figma)
- No server infrastructure required initially

### Negative
- Complexity in plugin lifecycle management
- Web Worker limitations for UI-heavy plugins
- Initial learning curve for plugin developers

### Neutral
- Existing features must be migrated to plugin format

## Related
- [ADR-021: Plugin Security Model](./ADR-021-plugin-security-model.md)
- [ADR-022: Plugin Distribution](./ADR-022-plugin-distribution.md)
```

### ADR-021-plugin-security-model.md

```markdown
# ADR-021: Plugin Security Model

## Status
Accepted

## Context
Community plugins pose security risks:
- Malicious code execution
- Data exfiltration
- UI spoofing
- Resource exhaustion

We need a security model that protects users while enabling useful plugins.

## Decision
Implement a tiered security model:

### Trust Levels
1. **Built-in:** Full trust, no restrictions
2. **Official:** Reviewed, light restrictions
3. **Community:** Sandboxed, strict restrictions

### Sandbox Implementation
- Web Workers for JavaScript isolation
- No DOM access from worker
- Message-passing for all API calls
- Timeouts on all operations

### Capability System
- Plugins declare required capabilities
- Low-risk capabilities auto-granted
- High-risk capabilities require user consent
- Some capabilities blocked for community tier

## Consequences

### Positive
- Users protected from malicious plugins
- Clear security boundaries
- Granular permission control

### Negative
- Some plugin types limited (UI-heavy)
- Additional complexity for developers
- Performance overhead from message passing

## Related
- [ADR-020: Plugin Architecture](./ADR-020-plugin-architecture.md)
```

### ADR-022-plugin-distribution.md

```markdown
# ADR-022: Plugin Distribution

## Status
Accepted

## Context
Plugins need a distribution mechanism. Options considered:
1. NPM packages
2. GitHub releases
3. Custom registry server
4. Static JSON + CDN

## Decision
Use static JSON registry hosted on GitHub:

### Registry Structure
```
github.com/itemdeck/plugins/
├── plugins.json           # Plugin index
└── plugins/
    └── {plugin-id}/
        ├── manifest.json  # Plugin manifest
        └── bundle.zip     # Plugin assets
```

### Client-Side Resolution
- Fetch plugins.json for browsing
- Download individual bundles on install
- Cache in IndexedDB for offline use

### Future Evolution
Server-based registry can be added later without breaking existing plugins.

## Consequences

### Positive
- No server infrastructure needed
- GitHub provides CDN, versioning, access control
- Easy community contributions via PRs

### Negative
- No dynamic features (download counts, ratings)
- Manual update process
- Limited to GitHub availability

## Related
- [ADR-020: Plugin Architecture](./ADR-020-plugin-architecture.md)
```

---

## Research Documentation

**Location:** `docs/development/research/`

### state-of-the-art-plugin-architecture.md

```markdown
# State of the Art: Plugin Architectures

## Executive Summary
Analysis of modern plugin systems to inform itemdeck's extensibility architecture. Key finding: JSON manifests with capability-based security provide the best balance of flexibility and safety for browser-based applications.

## Landscape Overview

### VS Code Extensions
- Manifest-based (package.json extension)
- Contribution points system
- Activation events for lazy loading
- Extension host process isolation

### Figma Plugins
- manifest.json + code.js
- Sandbox execution (iframe-based)
- Limited API surface
- UI via custom framework

### Obsidian Plugins
- manifest.json + main.js
- Direct DOM access (no sandbox)
- Full trust model
- Active community ecosystem

### Chrome Extensions
- manifest.json (v3)
- Service worker architecture
- Permission system
- Content scripts vs background

### WordPress Plugins
- PHP-based
- Hook/filter system
- No sandboxing
- Admin approval for hosted

## Comparison Matrix

| System | Manifest | Sandbox | Capabilities | Registry |
|--------|----------|---------|--------------|----------|
| VS Code | JSON | Process | Implicit | Marketplace |
| Figma | JSON | iframe | Limited | Community |
| Obsidian | JSON | None | Full | Community |
| Chrome | JSON | Worker | Declared | Store |
| WordPress | None | None | Full | Directory |

## Recommendation
Adopt VS Code/Chrome hybrid approach:
- JSON manifest with schema
- Capability declarations
- Web Worker sandbox for untrusted
- Static registry initially

## References
- [VS Code Extension API](https://code.visualstudio.com/api)
- [Figma Plugin API](https://www.figma.com/plugin-docs/)
- [Chrome Extensions MV3](https://developer.chrome.com/docs/extensions/mv3/)

---

## Related Documentation
- [ADR-020: Plugin Architecture](../decisions/adrs/ADR-020-plugin-architecture.md)
```

---

## Success Criteria

- [ ] Getting started guide created
- [ ] Manifest reference complete
- [ ] API reference complete
- [ ] Security guidelines complete
- [ ] Publishing guide complete
- [ ] Theme template created
- [ ] Mechanic template created
- [ ] Source template created (optional)
- [ ] ADR-020 (architecture) created
- [ ] ADR-021 (security) created
- [ ] ADR-022 (distribution) created
- [ ] State-of-the-art research created
- [ ] All documentation uses British English
- [ ] All internal links work

---

## Notes

- Use British English throughout
- Include code examples for all APIs
- Keep manifest reference up-to-date with schema
- Templates should be copy-paste ready
- ADRs follow standard format
